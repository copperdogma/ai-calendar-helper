# Docs Scratchpad

This document tracks notes related to documentation to be included in the final docs.

# Recommendations for AI-Targeted Documentation (Generated by AI Agent Jules) -- KEEP THIS

The following recommendations outline a new documentation structure designed to be comprehensive yet succinct, specifically for AI agents working with this codebase. The goal is to provide necessary context for development and debugging, focusing on project-specific aspects and guiding the AI to maintain a dynamic knowledge base.

**I. Proposed Documentation Structure:**

The documentation should be reorganized into the following main areas:

1.  **`AI_README_FIRST.md`**: The primary entry point for AI agents.
2.  **`ARCHITECTURE.md`**: High-level system architecture and design.
3.  **`FEATURE_GUIDES/`**: A directory containing detailed guides for specific subsystems and features.
4.  **`project-reference.mdc`**: The AI's dynamic, evolving knowledge base for this project.
5.  **`OPERATIONS_GUIDE.md`**: Information on setup, configuration, deployment, and troubleshooting.

**II. Key Documents and Their Content Strategy:**

- **1. `AI_README_FIRST.md`** (Replaces/enhances `docs/ai-agent-guide.md`)

  - **Purpose:** Quick onboarding for the AI.
  - **Content Highlights:**
    - Project introduction and core technologies.
    - Essential AI development scripts (`ai:start`, `ai:health`, etc.).
    - Guidance on using `project-reference.mdc`.
    - Map to other key documentation files.
    - Critical "Do and Don't" list for AI development.

- **2. `ARCHITECTURE.md`** (New)

  - **Purpose:** Explain the overall system structure and how components interact.
  - **Content Highlights:**
    - High-level system diagram (textual/linked).
    - Overview of frontend (Next.js, MUI, Theming), backend (API routes, Services), Database (PostgreSQL/Prisma), Auth, Caching (Redis), and Logging.
    - Key directory structure.
    - Typical request flows.

- **3. `FEATURE_GUIDES/` Directory** (New - consolidates many existing docs)

  - **Purpose:** Modular, in-depth guides for specific areas. Link to official documentation for generic technology details; focus on project-specific implementation.
  - **Key Guides:**
    - **`AUTH.md`**: NextAuth.js v5 authentication flow, user creation, session management, critical environment variables. (Consolidates `docs/nextauth-prisma-adapter*.md`).
    - **`DATABASE.md`**: Prisma schema, data modeling, service patterns (`UserService`), migrations, performance reminders.
    - **`TESTING.md`**: Unified guide for unit, integration, and E2E testing (Jest, Playwright), running tests, writing new tests. (Consolidates `docs/testing/*`, `docs/e2e-testing.md`).
    - **`LOGGING_AND_MONITORING.md`**: Pino logger setup, client/server logging, log access, request tracing. (Consolidates `docs/log.md`, `docs/logging.md`).
    - **`THEMING.md`**: MUI theming structure, customization.
    - **`STATE_MANAGEMENT.md`**: Client-side state (React Context, local state, Zustand for global state), guidance on usage.
    - **`CACHING.md`**: Redis integration, purpose, configuration, and usage patterns.
    - **`API_DEVELOPMENT.md`**: Creating API routes, error handling, auth, rate limiting.
    - **`CONTRIBUTING_AND_STANDARDS.md`**: Coding style (ESLint, Prettier), Git hooks, dependency management, code comment expectations, security best practices. (Incorporates `docs/formatting.md`, ESLint reasoning from `scratchpad.md`).

- **4. `project-reference.mdc`** (Existing - role clarified and emphasized)

  - **Purpose:** The AI's primary, dynamic knowledge base. This document is to be actively updated by the AI with project-specific details as development progresses.
  - **Content Structure Guidance:** Sections for Core Dependencies, Custom UI Components, API Endpoints, Key Configuration Decisions, Database Schema Notes, AI Development Log, Security Notes, and general TODOs.
  - **Instruction:** Static docs will provide foundational knowledge; this file captures the evolving state and specifics of _this_ template's implementation/instance.

- **5. `OPERATIONS_GUIDE.md`** (New - incorporates `SETUP.md`)
  - **Purpose:** Guide for setting up the environment, configuration, deployment, and common troubleshooting.
  - **Content Highlights:**
    - `npm run setup` and manual setup.
    - Detailed explanation of all environment variables in `.env.example`.
    - Production considerations (rate limiting: `RateLimiterMemory` vs. `RateLimiterRedis`).
    - Build and run commands.
    - Deployment advice.

**III. Guiding Principles for Documentation Content:**

- **Target Audience:** AI Agent (needs clear, structured, project-specific information).
- **Succinctness:** Avoid verbose explanations of general concepts the AI should know. Focus on _how_ they are applied _in this project_.
- **Link Externally:** For generic technology details, link to official documentation.
- **Actionable:** Provide information that helps the AI make decisions, write code, or troubleshoot.
- **Modularity:** Separate guides for distinct features to keep them manageable.
- **Avoid Redundancy:** Maintain a single source of truth for specific pieces of information and link accordingly.
- **Dynamic Knowledge:** Clearly distinguish between static foundational docs and the dynamic `project-reference.mdc`.

**IV. Deprecated/Consolidated Existing Documentation:**

The following existing documents will have their content merged into the new structure or will be removed if redundant/too generic:
`docs/ai-agent-guide.md`, `docs/e2e-testing.md`, `docs/formatting.md`, `docs/log.md`, `docs/logging.md`, `docs/nextauth-prisma-adapter*.md`, `docs/pwa-testing.md` (pending review of PWA feature relevance), `docs/solid-principles.md`, `docs/testing/*`, `docs/typescript-eslint-rules.md`, and `SETUP.md`.

By implementing these recommendations, the project will have a robust, AI-friendly documentation set that supports ongoing development and maintenance.

## ESLint Configuration Reasoning -- KEEP THIS

Okay, let's refine the ESLint configuration to strike that balance for an AI-driven template, leveraging linting as a helpful guardrail without causing excessive friction.

**Core Principles for AI-Centric Linting:**

1.  **Catch Critical Errors:** Rules preventing runtime errors, type errors, or fundamental syntax issues are essential. The AI needs these immediate flags.
2.  **Enforce Core Best Practices:** Rules promoting readability, maintainability, and preventing common pitfalls (like unused variables, incorrect hook usage) remain valuable.
3.  **Reduce "Nitpicky" Rules:** Rules that enforce stylistic choices with minimal impact on correctness or readability, or where TypeScript inference is usually sufficient, can be relaxed or disabled to avoid slowing the AI down with low-value fixes.
4.  **Leverage Auto-Fix:** Prioritize rules that ESLint can often fix automatically (`eslint --fix`).
5.  **Clear Configuration:** Ensure the configuration itself is clear and maintainable.

**Analysis of Current Rules vs. Ideal Balance:**

1.  **`@typescript-eslint/no-unused-vars` (Error):**

    - **AI Guardrail:** Excellent. Helps AI clean up effectively.
    - **Configuration:** Needs to allow ignoring variables prefixed with `_` (e.g., `argsIgnorePattern: "^_"`). This is crucial for intentional unused variables/parameters, a pattern AI might use or encounter.
    - **Recommendation:** Keep as **error**. Verify the `ignorePattern` is configured in `eslint.config.mjs`. [Ref: ESLint Docs - no-unused-vars options](https://eslint.org/docs/latest/rules/no-unused-vars)

2.  **`@typescript-eslint/explicit-function-return-type` (Warning):**

    - **AI Guardrail:** Minor benefit, as TypeScript often infers correctly. Can force AI explicitness but often leads to verbose code.
    - **Friction:** High friction (117 warnings currently). Fixing these is often low-value busy work for the AI, contradicting the "elegant simplicity" goal.
    - **Recommendation:** Change to **`'off'`** in `eslint.config.mjs`. TypeScript's inference is powerful, and other type rules will catch meaningful errors.

3.  **Parsing Errors & Type/Import Errors (Errors):**

    - **AI Guardrail:** Critical. These indicate fundamental code issues the AI _must_ fix.
    - **Recommendation:** Keep as **error**. These are non-negotiable for correctness.

4.  **`complexity` (Error):**

    - **AI Guardrail:** Useful deterrent against the AI generating overly complex spaghetti code.
    - **Friction:** Can be high if the threshold is too strict for common patterns. AI might struggle to refactor effectively.
    - **Recommendation:** Keep as **error**, but monitor if it frequently blocks the AI on reasonable code. If it becomes a major bottleneck, consider slightly increasing the threshold (e.g., `["error", { "max": 15 }]`) in `eslint.config.mjs`. For now, leave it at the default.

5.  **`@typescript-eslint/no-explicit-any` (Error):**
    - **AI Guardrail:** Essential for maintaining type safety, a core benefit of TypeScript. Pushes the AI to use proper types.
    - **Recommendation:** Keep as **error**.

**Other Considerations for the Config (`eslint.config.mjs`):**

- **Base Configurations:** Ensure you're extending reasonable base configs (like `eslint:recommended`, `plugin:@typescript-eslint/recommended-type-checked` or `strict-type-checked` if using typed rules, `plugin:react/recommended`, `plugin:react-hooks/recommended`, `plugin:jsx-a11y/recommended`

DOCS Todo - we'll do this at the end when all changes are done

- [ ] Update project-reference.mdc and anything test-running related (we now have e2e tests)
- [ ] Topics: Theming system, pm2+browsertool use (esp login), auth flow
- [ ] Redis: Where and how is it used?
- [ ] **README.md**: (Present)
- [ ] **Project Reference**: (`docs/project-reference.mdc` - Present)
  - [ ] Ensure current versions of components are present with links to docs (like MUI v7 where it constantly has trouble with the grid)
- [x] **Code Comments**: (Clarity and necessity - Requires deeper code review)
- [ ] **`.env.example`**:
  - [ ] Add comments explaining _why_ certain less obvious variables are needed (e.g., `NEXTAUTH_URL` for OAuth redirects, `NEXTAUTH_SECRET` for JWT encryption).
  - [ ] Make `DATABASE_URL` for test and production more explicitly different in the example (e.g., `next_auth_psql_app_test`, `next_auth_psql_app_prod`) to emphasize separation, even though comments cover this.
- [ ] **AI Guidance / Project Documentation (`project-reference.mdc` or similar):**
  - [ ] Clarify that when using the `dev:test` script, `NODE_ENV=test` might influence application behavior (logging, mocks).
  - [ ] Strongly emphasize that the `NEXTAUTH_SECRET` fallback in `lib/auth-edge.ts` for dev/test _must_ be replaced with a strong, unique secret in production.
  - [ ] While Zustand is fine, ensure the AI is guided to use it for genuinely global client state and not as a default for all client-side state if React context or local component state is more appropriate.
  - [ ] Add documentation stubs or reminders for the AI to document new API endpoints, components, or major architectural decisions.
  - [ ] Briefly document or include a placeholder for how more granular permission handling (beyond basic ADMIN/USER roles) could be implemented.
  - [ ] Add a simple example or documentation stub for caching strategies (e.g., with Redis).
  - [ ] Consider mentioning common PostgreSQL-specific optimizations or features if they are likely to be relevant for projects built from the template.
  - [ ] Stress the importance of keeping `project-reference.mdc` (or the main AI context document) updated as the template evolves or is used.
  - [ ] Guide the AI to consistently use the Next.js `<Image>` component for image optimization.
  - [ ] Remind the AI to add database indexes for frequently queried fields as new features and data models are introduced.
